<!DOCTYPE HTML>
<html>
  <head>
    <script src='https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js'></script>
    <script src="https://cdn.jsdelivr.net/npm/js-cookie@rc/dist/js.cookie.min.js"></script>
  </head>
  <body>
     <script>

      // Attempts to sign in with cookie if it exists
      if(Cookies.get('password') != undefined)
        signIn(Cookies.get('password'));

      // Filters user data from all data
      function filterUserData(passcode, data){
        for(let i = 1; i < data.length; i++){
          if(data[i][1] == passcode)
            return data[i];
        }
        return '';
      }

      // Triggers the signin call for the server
      function signIn(passcode){
        let xmlhttp = new XMLHttpRequest();
        xmlhttp.onreadystatechange = function() {
          if (this.readyState == 4 && this.status == 200) {
            let user = filterUserData(passcode, getData(passcode));
            if(user == '')
              $('#message').text("User not found");
            else
              $('#message').text('Welcome, ' + user[0]);
           Cookies.set('password', passcode);
          }
        }

        xmlhttp.open('GET', 'sheets.php?signIn='+passcode, true);
        xmlhttp.send();
        showData(passcode);
      }

      // Gets all the data from the server
      function getData(passcode) {
        let xmlhttp = new XMLHttpRequest();
        xmlhttp.onreadystatechange = function() {
          if (this.readyState == 4 && this.status == 200) {
            return(this.responseText);
          }
        }
        xmlhttp.open('GET', 'sheets.php?q='+passcode, true);
        xmlhttp.send();
      }

      // Shows the signed in users's data
      function showData(){

      }

      // Shows and updates all users signed in
      function showUsers(){

      }
      // Sends a request to create a new user
      function createUser(name, passcode) {
          if(name != "" && passcode != ""){
            let xmlhttp = new XMLHttpRequest();
            xmlhttp.onreadystatechange = function() {
              if (this.readyState == 4 && this.status == 200) {
                alert(this.responseText == 'User already exists' ? this.responseText : 'Successfully added user ' + this.responseText);
              }
            }
            xmlhttp.open('GET', 'sheets.php?createUser=' + name + '&passcode=' + passcode, true);
            xmlhttp.send();
            }
        }
      
    </script>
    login:
    <br>
    password: <input id='password'>
    <button id='signIn' onclick="signIn($('#password').val())">submit</button>
    <br><br>
    add user: 
    <br>
    name: <input id='name'>
    password: <input id='passcode'>
    <button onclick="createUser($('#name').val(), $('#passcode').val())">sign in</button>
    <p id='message'>you are not logged in</p>
  </body>
</html>
